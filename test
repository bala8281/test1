import json
import os
from google.cloud import storage

def read_json_files(bucket_name, root_path):
    exception_log = []

    try:
        storage_client = storage.Client()
        bucket = storage_client.bucket(bucket_name)

        blobs = bucket.list_blobs(prefix=root_path)
        for blob in blobs:
            try:
                with blob.download_as_string() as string_io:
                    data = json.loads(string_io.read().decode('utf-8'))
                    # Process the JSON data here
                    print(data)
            except json.JSONDecodeError as e:
                exception_log.append({
                    'filename': blob.name,
                    'error': str(e)
                })
                print('Error decoding JSON file: {}'.format(blob.name))
            except Exception as e:
                exception_log.append({
                    'filename': blob.name,
                    'error': str(e)
                })
                print('Error reading JSON file: {}'.format(blob.name))
    except Exception as e:
        exception_log.append({
            'filename': None,
            'error': str(e)
        })
        print('General error: {}'.format(e))

    # Log exceptions to a file
    if exception_log:
        with open('exception_log.txt', 'a') as f:
            for entry in exception_log:
                f.write('{}\n'.format(json.dumps(entry)))

if __name__ == '__main__':
    bucket_name = 'your_bucket_name'
    root_path = 'json/'

    read_json_files(bucket_name, root_path)
